<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Simulation View of Causality | Notes To An Earlier Self</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">Simulation View of Causality</span></h1>

<h2 class="date">2019/04/13</h2>
</div>

<main>



<style>
div.blue pre.r { background-color:azure; }
div.blue pre { background-color:blue; }
</style>
<p><em>I try to present an intuitive account of causal reasoning and the important notion of causal conditioning without resorting to some of the formalities of the rules of do-calculus, d-separation and the like.</em></p>
<p>First a little background to set up our running example.</p>
<p>The amount of energy generated by photovoltaic solar power-plants is decreased by not an insignificant amount when dirt and other particulates collect on the panels. This, so-called <em>soiling</em> problem is especially acute in dusty desert regions which are otherwise ideal sites for solar plants, because the sun shines bright when there aren’t many clouds in sight. Consequently plant operators are always on the lookout for cheap and effective panel soiling mitigation strategies.</p>
<p>Imagine that a meticulous solar-scientist named Sol is tasked with estimating the effect on the energy production of weekly washing of the panels in a fleet of solar power plants. Assume that he has at hand data on weekly aggregates of days of rainfall (denoted <span class="math inline">\(R\)</span>), weekly average cloud-cover (denoted <span class="math inline">\(C\)</span>), and total weekly energy production from the solar fleet (denoted <span class="math inline">\(E\)</span>). Sol reasons that if he could estimate the effect of having <em>at least</em> one day rainy day on energy production, he could use it as a proxy for weekly washing.</p>
<p>Before tackling the panel washing problem, Sol analyzes his data and incorporates known physical principles to construct a <em>generative model</em> for the data generating process. (Recall that a generative model is a story that we believe about a physical process written down in a language of probabilities.)</p>
<p>Commonsense tells Sol that clouds cause rain and that clouds cause a drop in energy production, while rain increases production by washing away the dirt on the panels. A graphical depiction (called the <em>causal graph</em>) of Sol’s mental model of the causal story hidden in the data is</p>
<p><img src="/post/2019-04-13-understanding-pearl-s-front-door-magic_files/solar_graph.png" style="width:30.0%" /></p>
<p>He estimates the necessary parameters of his model from the data, and implements his model as shown below to simulate behaviors or instances of the physical proess (i.e, generate joint samples of <span class="math inline">\((C, R, E)\)</span>.</p>
<div class="blue">
<pre class="r"><code>model = function(){
  c = runif(1, min=0, max=0.3)                         ## cloud-cover: C ~ Uniform(0, 0.3)
  r = floor(7 *(4*c^2 + runif(1, min=0, max=0.1)))     ## rainy-days: R = f_R(C, noise)
  e = 500 * (1 - 2*c + 0.1 * r) + 10 * rnorm(1)        ## energy: E = f_E(c, r, noise) 
  return(data.frame(C=c, R=r, E=e))
}</code></pre>
</div>
<p>Ignoring the particular functional forms we can notice that the order of computations follows the <em>topological</em> order of the variables in the graph above. The average cloudiness (<span class="math inline">\(C\)</span>) is a random variable, the rainy days variable (<span class="math inline">\(R\)</span>) is some function of <span class="math inline">\(C\)</span> and noise, and the energy (<span class="math inline">\(E\)</span>) is a function of <span class="math inline">\(C\)</span>, <span class="math inline">\(E\)</span> and different noise. The noisy functions attempt to capture both measurement and modeling errors.</p>
<p>Note that because of the noise variables, the above program defines a joint distribution over the triple <span class="math inline">\((C, R, E)\)</span>. In fact, Sol can compute the conditional density <span class="math inline">\(P(E | R=r)\)</span> by simply sampling from the simulator, filtering for <span class="math inline">\(R=r\)</span> and fitting a density estimator to the energy values on the filtered samples. The conditional densities look as below</p>
<p><img src="/post/2019-04-13-understanding-pearl-s-front-door-magic_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>According to the distribution defined by the simulator the hightest energy production tends to happen in weeks with no rain. This is perhaps mildly surpising for someone who hasn’t heard of <em>confounding</em>; the data shows this because both rain and energy are affected by their common cause, cloudiness.</p>
<p>Sol rewrites his simulator making the noise variables explicit as well as adding some optional arguments to override some of the computations as follows</p>
<div class="blue">
<pre class="r"><code>model = function(do_c, do_r, do_e, do_uc, do_ur, do_ue){
  uc = ifelse(missing(do_uc), runif(1), do_uc)       ## Uc ~ Uniform(0, 1)
  c = ifelse(missing(do_c), uc * 0.3, do_c)          ## C = Uc * 0.3 
  
  ur = ifelse(missing(do_ur), runif(1), do_ur)       ## Ur ~ Uniform(0, 1)
  r = ifelse(missing(do_r), 
             floor(7 *(4*c^2 + ur * 0.1)), do_r)     ## R = f_R(C, Ur)
  
  ue = ifelse(missing(do_ue), rnorm(1), do_ue)       ## Ue ~ Normal(0, 1)
  e = ifelse(missing(do_e), 
        500 * (1 - 2*c + 0.1 * r) + 10 * ue,
        do_e)                                        ## E = f_E(C, R, Ue)
  
  return(data.frame(C=c, R=r, E=e, Uc=uc, Ur=ur, Ue=ue))
}

generate = function(num_samples, ...){
  df &lt;- do.call(rbind, lapply(1:num_samples, function(i) model(...)))
  df$R &lt;- factor(df$R, levels=0:3)
  df
}</code></pre>
</div>
<p>Although the code now looks more complicated it implements exactly the same model as the version before it, albeit allowing Sol to arbitrarily set any of the variables to values of his choosing. Setting the function argument “do_x” allows Sol to surgically replace the value of variable <span class="math inline">\(X\)</span> in his simulation from what it would have been otherwise. (The “generate” function is just a helper to sample from the simulator.)</p>
<p>The underlying model can more clearly be depicted as</p>
<p><img src="/post/2019-04-13-understanding-pearl-s-front-door-magic_files/solar_graph_noise.png" style="width:30.0%" /></p>
<p>The awesome power conferred by a simulator in one’s possession brings a temptation to meddle that is hard to resist even for an old testament god, let alone a mere solar scientist. Sol dutifully proceeds to meddle.</p>
<div id="interventions" class="section level2">
<h2>Interventions</h2>
<p>To determine the <em>causal</em> effect of rain on energy production, Sol needs to simulate the process in a <em>parallel universe</em> where rain can be controlled independently of its influence from cloudiness. (He is after all investigating the effect panel washing would have on energy production, and cloudiness would not affect the decision to wash.) He intervenes to set the rain variable to different values as follows</p>
<div class="blue">
<pre class="r"><code>n &lt;- 10000
#generate n samples by setting do_r to different values 0, 1, 2, 3
df &lt;- do.call(rbind, lapply(0:3,function(r) generate(n, do_r = r)))
ggplot(aes(E, fill = R, color = R), data=df) + geom_density(alpha = 0.1)+ggtitle(&quot;P(E | do(R))&quot;)</code></pre>
<p><img src="/post/2019-04-13-understanding-pearl-s-front-door-magic_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<p>The quantity <span class="math inline">\(P(E|do(R=r))\)</span> is shorthand for the distribution of <span class="math inline">\(E\)</span> produced when Sol samples from his simulator by setting the “do_r” argument to the value <span class="math inline">\(r\)</span>.</p>
<p>Contrary to the conditional probabilities estimated before, this simulation shows that more rain <em>causes</em> more energy. The quantity <span class="math inline">\(P(E | do(R =r))\)</span> is called the <strong>causal conditional probability</strong> and is in general <em>different</em> from the <strong>Bayesian conditional probability</strong> <span class="math inline">\(P(E|R=r)\)</span>.</p>
<p>A graphical representation of the way the process unfolds in the parallel universe (and of the program that simulates it) is</p>
<p><img src="/post/2019-04-13-understanding-pearl-s-front-door-magic_files/solar_graph_do_r.png" style="width:30.0%" /></p>
<p>All the arrows pointing to the node <span class="math inline">\(R\)</span> have been severed and its value is set to <span class="math inline">\(r\)</span>. This is the essence of what it means to intervene – we remove any other causal influences on the variable on which we are intervening. This is why Bayesian conditioning differs from causal conditioning – when we causally condition, we are hypothesizing a different universe which is running a <em>different program</em>, consequently producing a <em>different distribution</em> over the observables.</p>
<p>Now is a good juncture to stop to rest and gaze upon the scenery. As a warmup for what is coming next the reader might want to mull the following questions. Looking at the order of the calculations in Sol’s simulator above may help.</p>
<ul>
<li>What is <span class="math inline">\(P(E | do(R=r), do(U_r=u_r))\)</span>?</li>
<li>How does <span class="math inline">\(P(E|do(C = c))\)</span> compare with <span class="math inline">\(P(E|C=c)\)</span>?</li>
<li>How could we compute <span class="math inline">\(P(E|do(R=r), C=c)\)</span>?</li>
<li>What is the interpretation of <span class="math inline">\(P(E|do(U_r = u_r))\)</span>?</li>
</ul>
</div>
<div id="counterfactuals" class="section level2">
<h2>Counterfactuals</h2>
<p>Let us consider a single sample generated by Sol’s simulator.</p>
</div>

</main>

  <footer>
  <footer>
<br /> <br /> <hr> <div class="just-comments" data-apikey="6e288633-d2ef-48b5-ae19-e03c38c46c67"></div>
</footer>

<script async src="https://just-comments.com/w.js"></script>

<script src="//yihui.name/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script async src="//yihui.name/js/center-img.js"></script>

  
  <hr/>
  &copy; Harsha Veeramachaneni 2019. Made using  <a href="https://github.com/rstudio/blogdown">blogdown</a> &amp; <a href="https://gohugo.io/">Hugo</a>
  
  </footer>
  </body>
</html>

